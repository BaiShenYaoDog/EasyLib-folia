plugins {
    id 'java'
    id 'maven-publish'
    id 'org.jetbrains.kotlin.jvm' version '1.8.0'
    id("com.github.johnrengelman.shadow") version("7.1.2")
}

allprojects {
    apply plugin: 'java'
    apply plugin: 'org.jetbrains.kotlin.jvm'

    group = 'com.xbaimiao'
    version = '2.0.2'

    repositories {
        mavenCentral()
        maven { url 'https://maven.xbaimiao.com/repository/releases/' }
        maven { url 'https://repo.aikar.co/content/groups/aikar/' }
        maven { url "https://repo.dmulloy2.net/repository/public/" }
        maven {
            name 'CodeMC'
            url 'https://repo.codemc.org/repository/maven-public/'
        }
        maven {
            name 'PaperMC'
            url 'https://repo.papermc.io/repository/maven-snapshots/'
        }
    }

    dependencies {
        compileOnly 'org.jetbrains.kotlin:kotlin-stdlib:1.8.0'
        compileOnly 'com.j256.ormlite:ormlite-core:6.1'
        compileOnly 'com.j256.ormlite:ormlite-jdbc:6.1'
        compileOnly 'com.zaxxer:HikariCP:4.0.3'
        compileOnly("com.comphenix.protocol:ProtocolLib:4.7.0")
        compileOnly("public:vault:1.0.0")
        compileOnly("public:points:1.0.0")
    }

    compileKotlin {
        kotlinOptions.jvmTarget = '1.8'
    }

    compileTestKotlin {
        kotlinOptions.jvmTarget = '1.8'
    }

}

dependencies {
    compileOnly "net.kyori:adventure-api:4.13.1"
    compileOnly("public:paper:1.16.5")
    compileOnly("public:papi:1.0.0")
    compileOnly(fileTree("libs"))

    implementation(project(":easylib-api"))
    implementation(project(":easylib-folia"))
    implementation(project(":easylib-bukkit"))
    implementation(project(":easylib-bukkit-common"))
    implementation 'public:ik:1.0.0'
    implementation 'com.github.cryptomorin:XSeries:9.3.1'
}

tasks.register('sourcesJar', Jar) {
    it.group("build")
    classifier = 'sources'
    subprojects {
        from sourceSets.main.allSource
    }
    from sourceSets.main.allSource
}

tasks {
    build {
        artifacts {
            archives(shadowJar)
            archives(jar)
            archives(sourcesJar)
            archives(kotlinSourcesJar)
        }
    }
    assemble {
        dependsOn(clean)
    }
    shadowJar {
        dependencies {
            exclude(dependency("org.jetbrains.kotlin:"))
            exclude(dependency("org.jetbrains:"))
        }
        relocate("org.wltea.expression","com.xbaimiao.easylib.expression")
        relocate("com.cryptomorin.xseries", "com.xbaimiao.easylib.xseries")
    }
    // UTF-8
    compileJava {
        options.encoding = "UTF-8"
    }
}

publishing {
    repositories {
        mavenLocal()
        maven {
            credentials {
                username = project.findProperty("user").toString()
                password = project.findProperty("password").toString()
            }
            url("https://maven.xbaimiao.com/repository/releases/")
        }
    }
    publications {
        mavenJava(MavenPublication) {
            artifact jar
            artifact sourcesJar
            artifact shadowJar
        }
    }
}